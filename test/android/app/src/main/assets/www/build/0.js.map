{"version":3,"sources":["../../src/pages/scan/scan.module.ts","../../src/pages/scan/scan.ts"],"names":[],"mappings":"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","file":"0.js","sourcesContent":["import { NgModule } from '@angular/core';\nimport { IonicPageModule } from 'ionic-angular';\nimport { ScanPage } from './scan';\n\n@NgModule({\n  declarations: [\n    ScanPage,\n  ],\n  imports: [\n    IonicPageModule.forChild(ScanPage),\n  ],\n})\nexport class ScanPageModule {}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/scan/scan.module.ts","import { Component } from '@angular/core';\nimport { IonicPage, NavController, NavParams, App } from 'ionic-angular';\nimport { ModalController, ViewController } from 'ionic-angular';\nimport {AppBase} from \"../../app/app.base\";\nimport { StatusBar } from '@ionic-native/status-bar';\nimport { LocalNotifications } from '@ionic-native/local-notifications';\n\nimport { ViewChild } from '@angular/core';\nimport { Slides } from 'ionic-angular';\nimport { BLE } from '@ionic-native/ble';\nimport { NativeAudio } from '@ionic-native/native-audio';\nimport {AIDevice} from \"../home/aidevice\";\n/**\n * Generated class for the ScanPage page.\n *\n * See https://ionicframework.com/docs/components/#navigation for more info on\n * Ionic pages and navigation.\n */\n\n@IonicPage()\n@Component({\n  selector: 'page-scan',\n  templateUrl: 'scan.html'\n})\nexport class ScanPage  extends AppBase {\n  @ViewChild(\"myslider\") myslider: Slides;\n  devicelist=[];\n  selectdeviceid=\"\";\n  constructor(public navCtrl: NavController,public modalCtrl:ModalController \n    , public statusBar : StatusBar,public viewCtrl:ViewController,private localNotifications: LocalNotifications\n    ,private ble: BLE,public nativeAudio:NativeAudio\n  ) {\n    super(navCtrl,modalCtrl,viewCtrl,statusBar);\n  }\n  callnotify(){\n  \n\n   // this.nativeAudio.play('fall');\n\n    // this.localNotifications.schedule({\n    //   text: \"测试铃声\",\n    //   vibrate: true\n    // }); \n  }\n  onMyShow(){\n\n    this.ble.isEnabled().then(()=>{\n\n    },()=>{\n      this.ble.enable();\n    });\n\n    if(AppBase.IsMobileWeb){\n\n      this.myslider.stopAutoplay();\n      this.devicelist.push({name:\"test\",id:\"test:test:test:test\",advertising:{},riis:100,data:\"~~~\"});\n      this.myslider.slideNext();\n\n    }else{\n      if(this.ble.isEnabled){\n        this.tryScan();\n      }else{\n        var that=this;\n        this.ble.enable().then(()=>{\n          that.tryScan();\n        });\n      }\n    }\n\n    try{\n      AppBase.Storage.get(\"selectdeviceid\").then((id)=>{\n        this.selectdeviceid=id;\n      });\n    }catch(ex){\n\n    }\n  }\n  \n  tryScan(){\n    this.ble.startScanWithOptions([], { reportDuplicates: false }).subscribe((device) => {\n      var isclick=false;\n      if(device.advertising != undefined){\n        \n        var scanRecord = device.advertising.split(\",\");\n        var Version=AIDevice.GetVersion(scanRecord);\n\n        var mlength = AIDevice.GetwholeDatelength(Version);\n        if (scanRecord.length < mlength) {\n            return;\n        }\n        var mData=[];\n        if (Version == 0) {\n            mData = Array(7);\n        }\n        else if (Version == 1) {\n            mData = Array(7);\n        }\n        else if (Version == 2) {\n            mData = Array(8);\n        }\n        //\t\t\t\t\t\tmTimeOutHandler.removeCallbacks(mThreadTimeOut);\n        //\t\t\t\t\t\trunOnUiThread(capEnter);\n        var mdataPosition = AIDevice.GetDataPosition(Version);\n        for (var i = mdataPosition; i < (mData.length + mdataPosition); i++) {\n            mData[i - mdataPosition] = scanRecord[i];\n        }\n        //alert(mdataPosition);\n        //alert(JSON.stringify(mData));\n        if (mData[0] == 0x00 || mData[14] == 0x00) {\n        }else{\n          isclick=true;\n        }\n      }\n      //alert(isclick?\"clicked\":\"no click\");\n      if(device.name!=undefined&&device.name==\" LN-200c\"&&isclick==true){\n      if(AppBase.research==false&&device.id==this.selectdeviceid){\n        this.selectDevice(device);\n      }\n       device.data=JSON.stringify(device);\n       var advertising=device.advertising;\n       var scanRecord = device.advertising.split(\",\");\n       device.clicked=scanRecord[14]!=0x00;\n       var havedevice=false;\n       for(var i=0;i<this.devicelist.length;i++){\n         if(device.id==this.devicelist[i].id){\n           this.devicelist[i]=device;\n           havedevice=true;\n           break;\n         }\n       }\n       if(havedevice==false){\n        this.devicelist.push(device);\n       }\n       this.devicelist.sort((a,b)=>{\n        return parseInt(a.rssi)<parseInt(b.rssi)?1:-1;\n       });\n       \n       this.myslider.slideTo(1);\n       //this.ble.stopScan();\n       //this.close(device);\n      }\n      \n    },(error)=>{\n      alert(error);\n    },()=>{\n    });\n  }\n  selectDevice(device){\n    AppBase.research=false;\n    AppBase.Storage.set(\"selectdeviceid\",device.id);\n    this.close(device);\n  }\n}\n\n\n// WEBPACK FOOTER //\n// ./src/pages/scan/scan.ts"],"sourceRoot":""}